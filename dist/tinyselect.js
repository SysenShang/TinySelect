/**
 * TinySelect 0.3.0 2017-04-05
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<P.length;h++)if(g=P[h],g.context.get(0)===f)return g;return g=new d.fn.init(f,c,e),P.push(g),g}}function e(a){if(a.option.mode!==Ja){var b=a.context;b.addClass(X).append(Ua(Z)),a.option.readonly&&b.addClass(_),a.option.result.multi||(b.addClass(Y).append(Ua($)),/static/i.test(b.css("position"))&&b.css("position","relative"))}}function f(a){var c=a.option,d=a.context,e=a.dom=Ua(aa).addClass(W+"-mode-"+c.mode);switch(c.mode){case Ja:c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=d.css("position");c.style.position=/static/i.test(f)?"relative":f,d.append(e);break;case Ia:b(Q.body).append(e);break;case Ka:var h=a.mask=Ua(ba);b(Q.body).append(h.append(e))}e.addClass(c.css).css(c.style).append(g(a,c));var j=c.box,k=a.box=Ua(ka).addClass(ka+"-layout-"+j.layout).addClass(j.css).css(j.style);j.layout===Oa&&k.append(Ua(ca)),e.append(k),e.append(i(a,c))}function g(a,b){var c=b.header,d=a.header=Ua(ea).addClass(c.css).css(c.style);return h(a,d,b),c.render&&c.render.call(d,b.item.data,a),d}function h(c,d,e){var f=e.header.filter,g=b('<input type="text"  placeholder="'+f.placeholder+'" class="'+sa+'" />').addClass(f.css).css(f.style);g.keyup(function(d){var e=g.val();O&&(a.clearTimeout(O),O=0),(/^change$/i.test(f.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||g.data("last")!==e:13===d.keyCode)&&(g.data("last",e),O=S(function(){c.filter(e,T)},f.delay))}),f.render&&f.render.call(g,d,c),d.append(g)}function i(a,b){var c=b.footer,d=a.footer=Ua(fa).addClass(c.css).css(c.style),e=Ua(ga),f=Ua(ha);return f.append(Ua(ia,Ca).html(c.totalTpl.replace(Ha,0))),d.append(e).append(f),b.result.multi&&j(a,b,e,f),c.render&&c.render.call(d,b.data,a),d}function j(a,c,d,e){var f=b(Da);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");H(a,Ba).each(function(d,e){if(e=b(e),c){if(e.hasClass(qa))return;return void D(a,e,T)}e.hasClass(qa)&&E(a,e,T)})});var g=Ua(ja,Ca);J(c,g),e.prepend(g)}function k(a,c){var d=c.id,e=c.flag,f=c.valueField,g=c.textField||f,h={key:null,title:c.unknown};h[d]=0,h[e]=T;var i=[h],j={},k=0;b.each(a,function(){var a=this,b=Ra(a,f),c=Ra(a,g);if(!b)return a[d]=0,void i.push(a);var e=a[f],h=c?a[g]:"";Ra(j,e)||(j[e]={id:++k,text:h,data:[]}),a[d]=k,j[e].data.push(a)});var l=[];return b.each(j,function(a,b){var c={key:a,title:b.text};c[d]=b.id,c[e]=T,l.push(c),Va(l,b.data)}),i.length>1&&Va(l,i),l}function l(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=parseInt(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Oa?d.find(c.build(ca).first()).empty():d.empty(),B(a),a.dom.removeClass(da);var l=F(a);if(M(l,j),I(e,l),!j)return d.append(e.box.empty),a.dom.addClass(da),void(b&&b.call(a,g));h.valueField&&(g=k(g,h),j=g.length);var n=m(a,d,f,g,b,0,i);if(!(0===i||i>=j)){if(isNaN(parseInt(a.dom.get(0).style.height))){var o=parseInt(n.css("lineHeight"))+parseInt(n.css("paddingTop"))+parseInt(n.css("paddingBottom")),p=0;h.valueField&&(p=d.find(c.build(la).first()).height()),d.height(i*o+p)}else{var q=a.dom.height();a.header.is(Ba)&&(q-=a.header.height()),a.footer.is(Ba)&&(q-=a.footer.height()),d.height(q)}f.async?Sa(m,[a,d,f,g,b,i]):m(a,d,f,g,b,0)}}function m(a,b,d,e,f,g,h){var i;a.option.box.layout===Oa&&(b=b.find(c.build(ca).first()));var j=a.option.group,k=d.data;if(h=h||e.length-g,!(g>=e.length)){var l=g+h;l>e.length&&(l=e.length);for(var m=!!j.valueField,n=g;n<l;n++){var o=e[n];if(m&&o[j.flag]){var p=Ua(la).addClass(j.css).css(j.style).append(o.title).attr(Ga,o[j.id]);j.render&&j.render.call(p,o,a),b.append(p)}else{var q=M(Ua(ma),o),r=Ua(na),s=Ua(oa),t=Ua(pa);q.addClass(d.css).css(d.style).append(r).append(s).append(t),s.append(o[d.textField]),d.render&&d.render.call(q,o,n,k,a),q.attr(Fa,n),m&&q.attr(Ga,o._group_id_),b.append(q),i||(i=q)}}return l!==e.length?i:(d.value&&a.value(d.value,!0),f&&f.call(a,k),i)}}function n(c){c.option.mode!==Ja&&(o(c),r(c)),s(c),t(c),c.option.keyboard&&u(c),b(a).resize(function(){c.dom.is(Ba)&&(p(c.context,c.dom,c.option),q(c))})}function o(a){var b=a.context,c=a.dom;b.click(function(d){a.option.readonly||(b.is(d.target)||0!==b.find(d.target).length)&&(c.is(Ba)||a.show())})}function p(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height();g===Ia?(i-f.top-c.height()<h?f.top=f.top-h-2:f.top=f.top+c.height()+2,d.css({left:f.left,top:f.top,width:e.style.width||c.width()})):g===Ka&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function q(a){var b=a.dom,c=b.parent().height();(a.option.mode===Ja||b.height()>=c)&&b.height(c);var d=b.get(0).style.height;d&&!/auto/i.test(d)&&a.box.height(b.height()-8-(a.header.is(Ba)?a.header.height():0)-(a.footer.is(Ba)?a.footer.height():0))}function r(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Ba)&&c.hide()})}function s(a){a.box.on("click",c.build(ma).done(),function(){var c=b(this);C(a,c,T,T),a.option.result.multi||a.hide()})}function t(a){var b=a.context.find(c.build(Z).first()),d=G(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(wa,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Ja){var i=w(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}M(d,(L(d)||0)+1),J(e,d)}),g&&a.on(xa,function(a){b.find(c.build(ta).attr(Fa,a.index).first()).remove(),M(d,L(d)-1),J(e,d)})}function u(d){b(a).keydown(function(a){if(d.dom.is(Ba)){var b,e=d.dom.find(c.build(ra).first()),f=a.keyCode||a.which;if(40===f)b=0===e.length?H(d).eq(0):e.next();else{if(38!==f)return void(32===f?e.click():27===f&&d.hide());b=0===e.length?H(d).eq(0):e.prev()}b.length||(b=e),d.header.find("."+sa).blur(),b.focus(),e.removeClass(ra),b.addClass(ra),v(b)}}),d.dom.on("mouseover",c.build(ma).done(),function(){b(this).addClass(ra).siblings().removeClass(ra)})}function v(a){var b=a.parent();/auto/i.test(b.css("overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()},100)}function w(a,b,d){if(a.option.mode!==Ja)return Ua(ta).css(a.option.result.style).attr(Fa,d).append(Ua(ua,Ca).html(b)).append(Ua(va,Ca).click(function(){if(!a.option.readonly)return E(a,H(a,c.build().attr(Fa,d).first()),T),U}))}function x(a,b,c){var d=c.get(0);y(a,b,{target:d,data:L(c),index:c.attr(Fa)})}function y(a,b,c){Ra(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function z(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=H(a,c.build(qa).first());return 0===e.length?void 0:L(e)[d]}return H(a,c.build(qa).done()).map(function(a,c){return L(b(c))[d]})}function A(a,c,d){for(var e,f=b.makeArray(c),g=0,h=H(a);g<h.length;g++){e=b(h[g]);var i=f.indexOf(L(e)[a.option.item.valueField])!==-1;if(i&&(C(a,e,U,d),!a.option.result.multi))return}}function B(a){var d=H(a);if(a.context.find(c.build(Z).first()).empty(),a.option.result.multi)return void d.filter(c.build(qa).done()).each(function(c,d){E(a,b(d),T)});var e=d.filter(c.build(qa).first());e.length&&E(a,e,T)}function C(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(qa);if(!f){if(g)return;var h=b.siblings(c.build(qa).first());return h.length&&E(a,h,e),void D(a,b,e)}return g?void(d&&E(a,b,e)):void D(a,b,e)}function D(a,b,c){b.addClass(qa),c&&x(a,wa,b)}function E(a,b,c){b.removeClass(qa),c&&x(a,xa,b)}function F(a){return a.footer.find(c.build(ha).sub(ia).done())}function G(a){return a.footer.find(c.build(ha).sub(ja).done())}function H(a,b){return a.box.find(c.build(ma).addon(b).done())}function I(a,b){K(b,a.footer.totalTpl)}function J(a,b){K(b,a.footer.selectedTpl)}function K(a,b){a.html(b.replace(Ha,L(a)||0))}function L(a){return a.data(Ea)}function M(a,b){return a.data(Ea,b)}function N(a,b,d){var e=a.filter(c.build().attr(Ga,d).done());0===b.filter(c.build().attr(Ga,d).visible()).length?e.hide():e.show()}var O,P=[],Q=a.document,R=a.console,S=a.setTimeout,T=!0,U=!1,V=null,W="tinyselect",X=W+"-context",Y=X+"-with-arrow",Z=X+"-result",$=X+"-arrow",_=X+"-readonly",aa=W+"-container",ba=W+"-mask",ca=W+"-table-proxy",da=aa+"-empty",ea=W+"-header",fa=W+"-footer",ga=fa+"-left",ha=fa+"-right",ia=W+"-count-total",ja=W+"-count-selected",ka=W+"-box",la=W+"-group",ma=W+"-item",na=W+"-item-before",oa=W+"-item-text",pa=W+"-item-after",qa=ma+"-selected",ra=ma+"-hover",sa=W+"-filter",ta=W+"-result-item",ua=ta+"-text",va=ta+"-link",wa="select",xa="unselect",ya="ready",za=[wa,xa,ya],Aa="不支持此事件类型",Ba=":visible",Ca="span",Da='<input type="checkbox" style="vertical-align:-2px;" class="'+W+'-selectall" />',Ea="data",Fa="data-tiny-index",Ga="data-tiny-group",Ha="%s",Ia="dropdown",Ja="list",Ka="popup",La=[Ia,Ja,Ka],Ma="list",Na="grid",Oa="table",Pa=[Ma,Na,Oa],Qa={readonly:U,mode:Ia,keyboard:T,css:V,style:{lineHeight:"28px"},header:{render:U,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",render:U,css:V,style:{}},css:V,style:{}},box:{empty:"没有数据",layout:Ma,css:V,style:{}},group:{id:"_group_id_",flag:"_group_item_",valueField:U,textField:U,unknown:"未分组",render:U,css:V,style:{}},item:{data:[],value:U,valueField:"id",textField:"text",visible:5,render:U,async:T,css:V,style:{}},footer:{render:U,totalTpl:"共"+Ha+"项",selectedTpl:"选中"+Ha+"项/",css:V,style:{}},result:{multi:U,render:U,type:0,css:V,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("["+a+"]"):this.selector.push("["+a+"="+b+"]"),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Ba).done()},first:function(){return this.addon(":first").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Ra=function(a,b){return!a||a.hasOwnProperty(b)},Sa=function(a,b){S(function(){a.apply(V,b)},0)},Ta=function(a,c){return b.extend(T,b.isArray(a)?[]:{},a,c)},Ua=function(a,c){return b("<"+(c||"div")+' class="'+a+'">')},Va=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var g=this;if(b.isArray(c))g.option=Ta(Qa,{item:{data:c},result:{multi:d}});else{g.option=Ta(Qa,c);var h=g.option.mode||Ia;if(La.indexOf(h)===-1)throw new Error('Render mode "'+h+'" is not supported,\nhere is the valid modes:'+La.join());var i=g.option.layout||Ma;if(Pa.indexOf(i)===-1)throw new Error('Item layout "'+i+'" is not supported,\nhere is the valid modes:'+Pa.join())}return g.context=b(a),e(g),g.events={},f(g),n(g),g.load(g.option.item.data,function(a){y(g,ya,{data:a})}),g},on:function(a,b){var c=this;if(za.indexOf(a)===-1)return R.warn(Aa+":"+a),c;var d=c.events;return Ra(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(za.indexOf(a)===-1)return c;var d=c.events;if(!Ra(d,a))return c;var e=d[a],f=e.indexOf(b);return f!==-1&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Ja?b:(e===Ka&&b.mask.show(),p(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(ea).sub(sa).visible()).focus(),q(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;if(c===Ja)return b;var d=c===Ia?b.dom:b.mask;return d.fadeOut("fast",function(){a&&a.call(b)}),b},filter:function(a,d){function e(a){if(f.option.group.valueField){var c=b(a).attr(Ga),d=k[c];++d.handled<d.total||N(j,i,c)}}var f=this,g=[],h=b.isFunction(a),i=H(f),j=f.dom.find(c.build(la).done()),k={};return j.each(function(){var a=b(this).attr(Ga);k[a]={total:i.filter(c.build(ma).attr(Ga,a).done()).length,handled:0}}),i.each(function(c,f){f=b(f);var i=L(f);(h?a.call(this,i):f.text().indexOf(a.toString())!==-1)?(g.push({item:f,data:i}),d&&f.slideDown(50,function(){e(this)})):d&&f.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?z(c):(A(c,a,b),c)},clear:function(){return B(this),this},load:function(a,b){var c=this;return c.option.item.data=Ta(a),l(c,function(){q(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(_)):b.context.removeClass(_),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=Qa,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map