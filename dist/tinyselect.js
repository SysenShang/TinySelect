/**
 * TinySelect 0.3.0 2017-04-06
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinySelect.git
 * @示例: http://hyjiacan.oschina.io/tinyselect
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){"use strict";function c(a){this.selector=[],this.css(a)}function d(a,c,e){var f=b(a).get(0);if(f){for(var g,h=0;h<Q.length;h++)if(g=Q[h],g.context.get(0)===f)return g;return g=new d.fn.init(f,c,e),Q.push(g),g}}function e(a){var c=a.context.attr("data-field-name");if(c){var d=a.field=b('<input type="hidden" name="'+c+'" />');a.context.append(d)}}function f(a){if(a.option.mode!==Ka){var b=a.context;b.addClass(Y).append(Va($)),a.option.readonly&&b.addClass(aa),a.option.result.multi||(b.addClass(Z).append(Va(_)),/static/i.test(b.css("position"))&&b.css("position","relative"))}}function g(a){var c=a.option,d=a.context,e=a.dom=Va(ba).addClass(X+"-mode-"+c.mode);switch(c.mode){case Ka:c.style.width=d.siblings().length?d.width():"auto",c.style.height=d.height()||"auto";var f=d.css("position");c.style.position=/static/i.test(f)?"relative":f,d.append(e);break;case Ja:b(R.body).append(e);break;case La:var g=a.mask=Va(ca);b(R.body).append(g.append(e))}e.addClass(c.css).css(c.style).append(h(a,c));var i=c.box,k=a.box=Va(la).addClass(la+"-layout-"+i.layout).addClass(i.css).css(i.style);i.layout===Pa&&k.append(Va(da)),e.append(k),e.append(j(a,c))}function h(a,b){var c=b.header,d=a.header=Va(fa).addClass(c.css).css(c.style);return i(a,d,b),c.render&&c.render.call(d,b.item.data,a),d}function i(c,d,e){var f=e.header.filter,g=b('<input type="text"  placeholder="'+f.placeholder+'" class="'+ta+'" />').addClass(f.css).css(f.style);g.keyup(function(d){var e=g.val();P&&(a.clearTimeout(P),P=0),(/^change$/i.test(f.trigger)?""===b.trim(String.fromCharCode(d.keyCode||d.which))||g.data("last")!==e:13===d.keyCode)&&(g.data("last",e),P=T(function(){c.filter(e,U)},f.delay))}),f.render&&f.render.call(g,d,c),d.append(g)}function j(a,b){var c=b.footer,d=a.footer=Va(ga).addClass(c.css).css(c.style),e=Va(ha),f=Va(ia);return f.append(Va(ja,Da).html(c.totalTpl.replace(Ia,0))),d.append(e).append(f),b.result.multi&&k(a,b,e,f),c.render&&c.render.call(d,b.data,a),d}function k(a,c,d,e){var f=b(Ea);d.append(b("<label>").append(f).append("全选")),f.change(function(){var c=f.is(":checked");I(a,Ca).each(function(d,e){if(e=b(e),c){if(e.hasClass(ra))return;return void E(a,e,U)}e.hasClass(ra)&&F(a,e,U)})});var g=Va(ka,Da);K(c,g),e.prepend(g)}function l(a,c){var d=c.id,e=c.flag,f=c.valueField,g=c.textField||f,h={key:null,title:c.unknown};h[d]=0,h[e]=U;var i=[h],j={},k=0;b.each(a,function(){var a=this,b=Sa(a,f),c=Sa(a,g);if(!b)return a[d]=0,void i.push(a);var e=a[f],h=c?a[g]:"";Sa(j,e)||(j[e]={id:++k,text:h,data:[]}),a[d]=k,j[e].data.push(a)});var l=[];return b.each(j,function(a,b){var c={key:a,title:b.text};c[d]=b.id,c[e]=U,l.push(c),Wa(l,b.data)}),i.length>1&&Wa(l,i),l}function m(a,b){var d=a.box,e=a.option,f=e.item,g=f.data,h=e.group,i=parseInt(f.visible);(isNaN(i)||i<0)&&(i=0);var j=g?g.length:0;d.height("auto"),e.box.layout===Pa?d.find(c.build(da).first()).empty():d.empty(),C(a),a.dom.removeClass(ea);var k=G(a);if(N(k,j),J(e,k),!j)return d.append(e.box.empty),a.dom.addClass(ea),void(b&&b.call(a,g));h.valueField&&(g=l(g,h),j=g.length);var m=n(a,d,f,g,b,0,i);if(!(0===i||i>=j)){if(isNaN(parseInt(a.dom.get(0).style.height))){var o=parseInt(m.css("lineHeight"))+parseInt(m.css("paddingTop"))+parseInt(m.css("paddingBottom")),p=0;h.valueField&&(p=d.find(c.build(ma).first()).height()),d.height(i*o+p)}else{var q=a.dom.height();a.header.is(Ca)&&(q-=a.header.height()),a.footer.is(Ca)&&(q-=a.footer.height()),d.height(q)}f.async?Ta(n,[a,d,f,g,b,i]):n(a,d,f,g,b,0)}}function n(a,b,d,e,f,g,h){var i;a.option.box.layout===Pa&&(b=b.find(c.build(da).first()));var j=a.option.group,k=d.data;if(h=h||e.length-g,!(g>=e.length)){var l=g+h;l>e.length&&(l=e.length);for(var m=!!j.valueField,n=g;n<l;n++){var o=e[n];if(m&&o[j.flag]){var p=Va(ma).addClass(j.css).css(j.style).append(o.title).attr(Ha,o[j.id]);j.render&&j.render.call(p,o,a),b.append(p)}else{var q=N(Va(na),o),r=Va(oa),s=Va(pa),t=Va(qa);q.addClass(d.css).css(d.style).append(r).append(s).append(t),s.append(o[d.textField]),d.render&&d.render.call(q,o,n,k,a),q.attr(Ga,n),m&&q.attr(Ha,o._group_id_),b.append(q),i||(i=q)}}return l!==e.length?i:(d.value&&a.value(d.value,!0),f&&f.call(a,k),i)}}function o(c){c.option.mode!==Ka&&(p(c),s(c)),t(c),u(c),c.option.keyboard&&v(c),b(a).resize(function(){c.dom.is(Ca)&&(q(c.context,c.dom,c.option),r(c))})}function p(a){var b=a.context,c=a.dom;b.click(function(d){a.option.readonly||(b.is(d.target)||0!==b.find(d.target).length)&&(c.is(Ca)||a.show())})}function q(c,d,e){var f=c.offset(),g=e.mode,h=d.height(),i=b(a).height();g===Ja?(i-f.top-c.height()<h?f.top=f.top-h-2:f.top=f.top+c.height()+2,d.css({left:f.left,top:f.top,width:e.style.width||c.width()})):g===La&&d.parent().css({paddingTop:(i-h)/3,paddingLeft:(b(a).width()-d.width())/2})}function r(a){var b=a.dom,c=b.parent().height();(a.option.mode===Ka||b.height()>=c)&&b.height(c);var d=b.get(0).style.height;d&&!/auto/i.test(d)&&a.box.height(b.height()-8-(a.header.is(Ca)?a.header.height():0)-(a.footer.is(Ca)?a.footer.height():0))}function s(c){var d=c.context,e=c.dom;b(a).click(function(a){var b=a.target;d.is(b)||e.is(b)||d.find(b).length||e.find(b).length||e.is(Ca)&&c.hide()})}function t(a){a.box.on("click",c.build(na).done(),function(){var c=b(this);D(a,c,U,U),a.option.result.multi||a.hide()})}function u(a){var b=a.context.find(c.build($).first()),d=H(a),e=a.option,f=e.result,g=f.multi,h=f.render;a.on(xa,function(c){var f=c.data[e.item.textField];if(f=h?h.call(c.target,c.data):f,!g)return void b.html(f);if(e.mode!==Ka){var i=x(a,f,c.index);b.append(i),b.stop().animate({scrollTop:b[0].scrollHeight})}N(d,(M(d)||0)+1),K(e,d)}),g&&a.on(ya,function(a){b.find(c.build(ua).attr(Ga,a.index).first()).remove(),N(d,M(d)-1),K(e,d)})}function v(d){b(a).keydown(function(a){if(d.dom.is(Ca)){var b,e=d.dom.find(c.build(sa).first()),f=a.keyCode||a.which;if(40===f)b=0===e.length?I(d).eq(0):e.next();else{if(38!==f)return void(32===f?e.click():27===f&&d.hide());b=0===e.length?I(d).eq(0):e.prev()}b.length||(b=e),d.header.find("."+ta).blur(),b.focus(),e.removeClass(sa),b.addClass(sa),w(b)}}),d.dom.on("mouseover",c.build(na).done(),function(){b(this).addClass(sa).siblings().removeClass(sa)})}function w(a){var b=a.parent();/auto/i.test(b.css("overflowY"))||(b=b.parent()),b.stop().animate({scrollTop:a.offset().top-b.offset().top+b.scrollTop()},100)}function x(a,b,d){if(a.option.mode!==Ka)return Va(ua).css(a.option.result.style).attr(Ga,d).append(Va(va,Da).html(b)).append(Va(wa,Da).click(function(){if(!a.option.readonly)return F(a,I(a,c.build().attr(Ga,d).first()),U),V}))}function y(a,b,c){var d=c.get(0);z(a,b,{target:d,data:M(c),index:c.attr(Ga)})}function z(a,b,c){Sa(a.events,b)&&(c.type=b,a.events[b].forEach(function(b){b.call(a,c)}))}function A(a){var d=a.option.item.valueField;if(!a.option.result.multi){var e=I(a,c.build(ra).first());return 0===e.length?void 0:M(e)[d]}return I(a,c.build(ra).done()).map(function(a,c){return M(b(c))[d]})}function B(a,c,d){for(var e,f=b.makeArray(c),g=0,h=I(a);g<h.length;g++){e=b(h[g]);var i=f.indexOf(M(e)[a.option.item.valueField])!==-1;if(i&&(D(a,e,V,d),!a.option.result.multi))return}}function C(a){var d=I(a);if(a.context.find(c.build($).first()).empty(),a.option.result.multi)return void d.filter(c.build(ra).done()).each(function(c,d){F(a,b(d),U)});var e=d.filter(c.build(ra).first());e.length&&F(a,e,U)}function D(a,b,d,e){var f=a.option.result.multi,g=b.hasClass(ra);if(!f){if(g)return;var h=b.siblings(c.build(ra).first());return h.length&&F(a,h,e),void E(a,b,e)}return g?void(d&&F(a,b,e)):void E(a,b,e)}function E(a,b,c){b.addClass(ra),c&&y(a,xa,b)}function F(a,b,c){b.removeClass(ra),c&&y(a,ya,b)}function G(a){return a.footer.find(c.build(ia).sub(ja).done())}function H(a){return a.footer.find(c.build(ia).sub(ka).done())}function I(a,b){return a.box.find(c.build(na).addon(b).done())}function J(a,b){L(b,a.footer.totalTpl)}function K(a,b){L(b,a.footer.selectedTpl)}function L(a,b){a.html(b.replace(Ia,M(a)||0))}function M(a){return a.data(Fa)}function N(a,b){return a.data(Fa,b)}function O(a,b,d){var e=a.filter(c.build().attr(Ha,d).done());0===b.filter(c.build().attr(Ha,d).visible()).length?e.hide():e.show()}var P,Q=[],R=a.document,S=a.console,T=a.setTimeout,U=!0,V=!1,W=null,X="tinyselect",Y=X+"-context",Z=Y+"-with-arrow",$=Y+"-result",_=Y+"-arrow",aa=Y+"-readonly",ba=X+"-container",ca=X+"-mask",da=X+"-table-proxy",ea=ba+"-empty",fa=X+"-header",ga=X+"-footer",ha=ga+"-left",ia=ga+"-right",ja=X+"-count-total",ka=X+"-count-selected",la=X+"-box",ma=X+"-group",na=X+"-item",oa=X+"-item-before",pa=X+"-item-text",qa=X+"-item-after",ra=na+"-selected",sa=na+"-hover",ta=X+"-filter",ua=X+"-result-item",va=ua+"-text",wa=ua+"-link",xa="select",ya="unselect",za="ready",Aa=[xa,ya,za],Ba="不支持此事件类型",Ca=":visible",Da="span",Ea='<input type="checkbox" style="vertical-align:-2px;" class="'+X+'-selectall" />',Fa="data",Ga="data-tiny-index",Ha="data-tiny-group",Ia="%s",Ja="dropdown",Ka="list",La="popup",Ma=[Ja,Ka,La],Na="list",Oa="grid",Pa="table",Qa=[Na,Oa,Pa],Ra={readonly:V,mode:Ja,keyboard:U,css:W,style:{lineHeight:"28px"},header:{render:V,filter:{trigger:"enter",delay:618,placeholder:"输入后按回车过滤",render:V,css:W,style:{}},css:W,style:{}},box:{empty:"没有数据",layout:Na,css:W,style:{}},group:{id:"_group_id_",flag:"_group_item_",valueField:V,textField:V,unknown:"未分组",render:V,css:W,style:{}},item:{data:[],value:V,valueField:"id",textField:"text",visible:5,render:V,async:U,css:W,style:{}},footer:{render:V,totalTpl:"共"+Ia+"项",selectedTpl:"选中"+Ia+"项/",css:W,style:{}},result:{multi:V,render:V,type:0,css:W,style:{}}};c.prototype={constructor:c,css:function(a){return a&&this.selector.push("."+a),this},attr:function(a,b){return 1===arguments.length?this.selector.push("["+a+"]"):this.selector.push("["+a+"="+b+"]"),this},sub:function(a){return this.selector.push(" "),this.css(a)},visible:function(){return this.addon(Ca).done()},first:function(){return this.addon(":first").done()},addon:function(a){return a&&this.selector.push(a),this},done:function(a){return this.css(a),this.selector.join("")}},c.build=function(a){return new c(a)};var Sa=function(a,b){return!a||a.hasOwnProperty(b)},Ta=function(a,b){T(function(){a.apply(W,b)},0)},Ua=function(a,c){return b.extend(U,b.isArray(a)?[]:{},a,c)},Va=function(a,c){return b("<"+(c||"div")+' class="'+a+'">')},Wa=function(a,b){Array.prototype.push.apply(a,b)};d.fn=d.prototype={constructor:d,init:function(a,c,d){var h=this;if(b.isArray(c))h.option=Ua(Ra,{item:{data:c},result:{multi:d}});else{h.option=Ua(Ra,c);var i=h.option.mode||Ja;if(Ma.indexOf(i)===-1)throw new Error('Render mode "'+i+'" is not supported,\nhere is the valid modes:'+Ma.join());var j=h.option.layout||Na;if(Qa.indexOf(j)===-1)throw new Error('Item layout "'+j+'" is not supported,\nhere is the valid modes:'+Qa.join())}return h.context=b(a),e(h),f(h),h.events={},g(h),o(h),h.load(h.option.item.data,function(a){z(h,za,{data:a})}),h},on:function(a,b){var c=this;if(Aa.indexOf(a)===-1)return S.warn(Ba+":"+a),c;var d=c.events;return Sa(d,a)?d[a].push(b):d[a]=[b],c},off:function(a,b){var c=this;if(Aa.indexOf(a)===-1)return c;var d=c.events;if(!Sa(d,a))return c;var e=d[a],f=e.indexOf(b);return f!==-1&&e.splice(f,1),c},show:function(a){var b=this,d=b.dom,e=b.option.mode;return e===Ka?b:(e===La&&b.mask.show(),q(b.context,d,b.option),d.fadeIn("fast",function(){d.find(c.build(fa).sub(ta).visible()).focus(),r(b),a&&a.call(b)}),b)},hide:function(a){var b=this,c=b.option.mode;if(c===Ka)return b;var d=c===Ja?b.dom:b.mask;return d.fadeOut("fast",function(){a&&a.call(b)}),b},filter:function(a,d){function e(a){if(f.option.group.valueField){var c=b(a).attr(Ha),d=k[c];++d.handled<d.total||O(j,i,c)}}var f=this,g=[],h=b.isFunction(a),i=I(f),j=f.dom.find(c.build(ma).done()),k={};return j.each(function(){var a=b(this).attr(Ha);k[a]={total:i.filter(c.build(na).attr(Ha,a).done()).length,handled:0}}),i.each(function(c,f){f=b(f);var i=M(f);(h?a.call(this,i):f.text().indexOf(a.toString())!==-1)?(g.push({item:f,data:i}),d&&f.slideDown(50,function(){e(this)})):d&&f.slideUp(50,function(){e(this)})}),g},value:function(a,b){var c=this;return 0===arguments.length?A(c):(B(c,a,b),c)},clear:function(){return C(this),this},load:function(a,b){var c=this;return c.option.item.data=Ua(a),m(c,function(){r(c),b&&b.call(c,c.option.item.data)}),c},readonly:function(a){var b=this;return 0===arguments.length?b.option.readonly:(a?(b.hide(),b.context.addClass(aa)):b.context.removeClass(aa),b.option.readonly=a,b)}},d.fn.init.prototype=d.fn,d.defaults=Ra,a.tinyselect=d}(window,jQuery);
//# sourceMappingURL=tinyselect.js.map